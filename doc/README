1.  INTRODUCTION

    The OpenLISP control-plane implements the functions of LISP (Locator/Identifier Separation Protocol) control plane.
    Please refer to IETF LISP drafts for a description of LISP control plane, its acronyms and 
    the control-plane functionalities. 	
    
    Please be aware that, differently than with the version for FreeBSD enviroment this Linux version only support control-plane functions as  DDT/MS/MR, because the OpenLISP data-plane has not been ported to Linux, yet.. 

    This linux version includes all basic control-plane functions: xTR, MS, MR/DDT, DDT.

2. CONFIGURATION FILES

    The configuration relies on a main configuration file named "opencp.conf" that points to specific xml files: 
    one for the xTR part, one for the MS part and one for the MR/DDT part.
    xml files include many sections using tags <db> and </db>.


    *** opencp.conf - main configuration file
    # Functions: MS (Map-Server), MR (DDT Map-Resolver) or DDT(DDT-only node)
    # NB: End of file with an empty line
    functions = mr ms ddt

    #Set debug level:
    # 0 - not debug nothing will printed to consol
    # 1 - simple debug, with little information
    # 2 - full debug
    debug_level = 2

    #Choose source IP for map-request packet
    #Default is auto, by select the ip of the first interface
    source_ipv4 = auto
    source_ipv6 = auto

    #Set size of open control-plane queue size
    #default is 1000
    queue_size = default


    #Parameter to setup worker pool
    #min_threads:    the minimum number of threads kept in the pool,
    #	         always available to perform work requests.
    #		 Default: 1
    min_thread = default
    #max_threads:    the maximum number of threads that can be
    #		 in the pool, performing work requests.
    #		 Default: 2
    max_thread = default

    #linger:        the number of seconds excess idle worker threads
    #		(greater than min_threads) linger before exiting.
    #		Default: 10 seconds    
    linger_thread = default

    ##
    ## Specific settings for each functions
    ##

    ms_configure = opencp_ms.xml
    node_configure = opencp_node.xml
    mr_configure = opencp_mr.xml
    
    *** opencp_ms.xml - map-server configuration

    * The <geid> section defines the IP prefixes the map-server allows ETR to register to. 
      The IP ranges must not overlap.
    
    * One or more <site> sections. Each section includes the information for one site: 
      site name, key for map-register messages, EID IP prefixes the site can register. 
      NB: the key is case sensitive and must not include spaces.

    * Here is a sample file

    <?xml version="1.0" encoding="ISO-8859-1"?>
    <db>
	 <geid>
		<arrange>153.16.38.0/24</arrange>
		<arrange>153.16.44.0/24</arrange>
		<arrange>153.16.70.0/24</arrange>
		<arrange>192.168.0.0/16</arrange>
		<arrange family="IPv6">2610:D0::/32</arrange>
	 </geid>
	 
	 <site>
		<name>SITE1</name>
		<key>SITE1-KEY-HERE</key>
		<contact>SITE1-EMAIL-HERE</contact>
		<active>yes</active>

		<eid>
			<addr family="IPv4">A.B.C.D/24</addr>
			<active>yes</active>
		</eid>

		<eid>
			<addr family="IPv6">A:B:C::/48</addr>
			<active>yes</active>
		</eid>
	</site>
	
	<site>
		<name>SITE2</name>
		<key>SITE2-KEY-HERE</key>
		<contact>SITE2-EMAIL-HERE</contact>
		<active>yes</active>

		<eid>
			<addr family="IPv4">E.F.G.H/28</addr>
			<active>yes</active>
		</eid>

		<eid>
			<addr family="IPv6">E:F:G::/48</addr>
			<active>yes</active>
		</eid>
	</site>

    </db>

    **** opencp_mr.xml - MR configuration file

    * <geid> section defines the IP prefix(es) MR accepts map-request for. 
	The IP ranges must not be overlap. 
    
    * One or more <eid> sections. Each section containes the information for one delegated prefix node
	which MR with follow to find the correct ETR to answer a Map-Request.

    * For more information about DDT Map Resolver, please refer to the IETF drafts.
    
    * Here is a sample file

    <?xml version="1.0" encoding="ISO-8859-1"?>
    <db>
	<geid>
		<arrange>153.17.0.0/16</arrange>
		<arrange>153.18.0.0/16</arrange>
		<arrange>192.0.0.0/8</arrange>
		<arrange family="IPv6">2610:d0::/32</arrange>
	 </geid>

	<eid prefix="153.17.0.0/16" ttl="1440" a="true" referral="true">
		<rloc>
			<address>112.137.129.44</address>
			<priority>1</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
		<rloc>
			<address>112.137.129.45</address>
			<priority>10</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
	</eid>
	
	<eid prefix="192.100.0.0/16" ttl="1440" a="true" referral="true">
		<rloc>
			<address>112.137.129.44</address>
			<priority>10</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
		<rloc>
			<address>112.137.129.45</address>
			<priority>1</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
	</eid>
	
	<eid prefix="0.0.0.0/0" referral="true" incomplete="false">
		<rloc>
			<address>192.149.252.136</address>
			<priority>1</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
	</eid>
	
	<eid prefix="2610:d0::/16" referral="true" incomplete="false">
		<rloc>
			<address>2001:67c:2980::2980</address>
			<priority>1</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
	</eid>
    </db>

    **** opencp_node.xml - DDT node configuration file

    * <geid> section defines the IP prefix(es) the node is delegated. The IP ranges must not be overlap. 
      NB: if the node is a DDT root, then it is here configured as being delegated for 0.0.0.0/0 (IPv4) 
      and 0::/0 (IPv6).

    * One or more <eid> sections. Each section containes the information for one delegated prefix.

    * Special <eid> sections with prefix equal 0.0.0.0/0 or 0::/0 is for DDT root nodes. 
      For the lisp4.net testbed, the root nodes are documented here: http://ddt-root.org/

    * For more information about prefix delegation and DDT, please refer to the IETF drafts.

    * Here is a sample file

    <?xml version="1.0" encoding="ISO-8859-1"?>
    <db>
	<geid>
		<arrange>153.17.0.0/16</arrange>
		<arrange>153.18.0.0/16</arrange>
		<arrange>192.0.0.0/8</arrange>
		<arrange family="IPv6">2610:d0::/32</arrange>
	 </geid>

	<eid prefix="153.17.0.0/16" ttl="1440" a="true" referral="true">
		<rloc>
			<address>112.137.129.44</address>
			<priority>1</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
		<rloc>
			<address>112.137.129.45</address>
			<priority>10</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
	</eid>
	
	<eid prefix="192.100.0.0/16" ttl="1440" a="true" referral="true">
		<rloc>
			<address>112.137.129.44</address>
			<priority>10</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
		<rloc>
			<address>112.137.129.45</address>
			<priority>1</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
	</eid>
	
	<eid prefix="0.0.0.0/0" referral="true" incomplete="false">
		<rloc>
			<address>192.149.252.136</address>
			<priority>1</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
	</eid>
	
	<eid prefix="2610:d0::/16" referral="true" incomplete="false">
		<rloc>
			<address>2001:67c:2980::2980</address>
			<priority>1</priority>
			<weight>100</weight>
			<reachable>true</reachable>
		</rloc>
	</eid>
    </db>


3. DEBUG
    When running, the program prints debug information to the console so you can follow the processing. 
    It also includes another method to debug by interacting with the program using the console. 
    At this version, supported commands are:
	
	map-database

	reload 
	
	map-register <EID-prefix> version <version_number>  A <true|false> TTL <time_to_live> /
	  < -rloc address <rloc_addr>  priority <rloc_priority> weight <rloc_weight> m_weight <rloc_m_weight> /
	  m_priority <rloc_m_priority> reachable <true|false> ...>

	map-request <EID-prefix>  <nonce>
		   
4. INSTALL
    
    Please refer to the INSTALL file in tarball source code.


5. CHANGE LOG

#Version 01.0 : 01/2014
	By Dung Chi Phung - VNU Hanoi & LIP6 <dungpc@vnu.edu.vn> 

  * Ported from lisp-control-plane-freebsd-v3.1 to adapted to Linux
  * Only support control-plane function as MS, MR, DDT node
  
6. FORMAT OF IMPLEMENTED LISP CONTROL-PLANE MESSAGES 

##Map-Request message
	
	
	0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Type=1 |A|M|P|S|p|s|    Reserved     |   IRC   | Record Count  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         Nonce . . .                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         . . . Nonce                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |         Source-EID-AFI        |   Source EID Address  ...     |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |         ITR-RLOC-AFI 1        |    ITR-RLOC Address 1  ...    |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                              ...                              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |         ITR-RLOC-AFI n        |    ITR-RLOC Address n  ...    |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |   Reserved    | EID mask-len  |        EID-prefix-AFI         |
   Rec +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |                       EID-prefix  ...                         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                   Map-Reply Record  ...                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

##Map-reply message

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Type=2 |P|E|S|          Reserved               | Record Count  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         Nonce . . .                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         . . . Nonce                           |
   +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   |                          Record  TTL                          |
   |   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   R   | Locator Count | EID mask-len  | ACT |A|      Reserved         |
   e   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   c   | Rsvd  |  Map-Version Number   |       EID-prefix-AFI          |
   o   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   r   |                          EID-prefix                           |
   d   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  /|    Priority   |    Weight     |  M Priority   |   M Weight    |
   | L +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | o |        Unused Flags     |L|p|R|           Loc-AFI             |
   | c +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  \|                             Locator                           |
   +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

##Map-Register message

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Type=3 |P|            Reserved               |M| Record Count  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         Nonce . . .                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         . . . Nonce                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |            Key ID             |  Authentication Data Length   |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       ~                     Authentication Data                       ~
   +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   |                          Record  TTL                          |
   |   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   R   | Locator Count | EID mask-len  | ACT |A|      Reserved         |
   e   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   c   | Rsvd  |  Map-Version Number   |        EID-prefix-AFI         |
   o   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   r   |                          EID-prefix                           |
   d   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  /|    Priority   |    Weight     |  M Priority   |   M Weight    |
   | L +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | o |        Unused Flags     |L|p|R|           Loc-AFI             |
   | c +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  \|                             Locator                           |
   +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

##Encapsulated Control Message

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |                       IPv4 or IPv6 Header                     |
   OH  |                      (uses RLOC addresses)                    |
     \ |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |       Source Port = xxxx      |       Dest Port = 4342        |
   UDP +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |           UDP Length          |        UDP Checksum           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   LH  |Type=8 |S|D|                Reserved                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |                       IPv4 or IPv6 Header                     |
   IH  |                  (uses RLOC or EID addresses)                 |
     \ |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |       Source Port = xxxx      |       Dest Port = yyyy        |
   UDP +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |           UDP Length          |        UDP Checksum           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   LCM |                      LISP Control Message                     |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

"D" is the "DDT-originated" flag and is set by a DDT client to
indicate that the receiver can and should return Map-Referral
messages as appropriate.

##Map-Referral Message

	0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Type=6 |                Reserved               | Record Count  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         Nonce . . .                           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         . . . Nonce                           |
   +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   |                          Record  TTL                          |
   |   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   R   | Referral Count| EID mask-len  | ACT |A|I|     Reserved        |
   e   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   c   |SigCnt |   Map Version Number  |            EID-AFI            |
   o   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   r   |                          EID-prefix ...                       |
   d   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  /|    Priority   |    Weight     |  M Priority   |   M Weight    |
   | L +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | o |        Unused Flags         |R|         Loc/LCAF-AFI          |
   | c +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  \|                             Locator ...                       |
   +-> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

7. COMMENTS AND BUG REPORT
    
    Comments and bug report are welcome! The best is via https://github.com/lip6-lisp/control-plane.
